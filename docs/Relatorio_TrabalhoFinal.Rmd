---
title: "Qual filme produzir?"
author: "Natália Freitas"
date: "Maio 2022"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---

# **Ao produzir um filme, é possível adotar uma estratégia que atenda, simultaneamente, ambiciosos por fama e dinheiro ?**

### Será que o retorno financeiro de um filme está associado a avaliação de qualidade que recebe pelos críticos?

O IMDb *(Internet Movie Database)* é o maior banco de dados online sobre o cinema mundial. Contém informações sobre milhões de filmes e programas de TV e entreterimento.


Utilizando a base de dados IMDd[^1], este relatório objetiva avaliar a existência de uma estratégia, em termos de produção de filmes, que atenda, simultaneamente, a necessidade de retorno financeiro de um investidor e fama para um cinestra.

[^1]: A base de dados consiste em uma adaptação para o [Curso R para Ciência de Dados II](https://curso-r.com/)

Código para as análises pode ser acessado [GitHub nfreitas1990](https://github.com/nfreitas1990/CursoR_TrabalhoFinal)

```{r include = FALSE, echo = FALSE, message=FALSE, warning=FALSE}
# Carregar os Dados
imdb <- basesCursoR::pegar_base("imdb_completa")
imdb_pessoas <- basesCursoR::pegar_base("imdb_pessoas")
imdb_avaliacoes <- basesCursoR::pegar_base("imdb_avaliacoes")


```

```{r include = FALSE, echo = FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(tidyverse)
library(readr)
library(lubridate)
library(ggplot2)
library(purrr)
library(stringr)

```


```{r include = FALSE, echo = FALSE, message=FALSE, warning=FALSE}
# Preparação dos dados
# Acertar os dados:

# data_lancamento:criar coluna de mes e dia | Mudar tipo para date
          imdb <- imdb %>% 
                        mutate(data_lancamento = ymd(data_lancamento)) %>% 
                        separate(col = data_lancamento,
                                 into = c("ano_date","mes","dia"),  
                                 sep = "-", remove = FALSE) %>% 
                        select(-ano_date)
          
          class(imdb$data_lancamento)


      # ano: Mudar tipo
        
           imdb <- imdb %>% 
                    mutate(across(
                      .cols = c(ano, mes, dia),
                      .fns = as.factor))
           
## Dinheiro  
       
      # orcamento:Tirando o Caractere da moeda para transformar para numero e calcular o lucro
        imdb <-imdb %>% 
                   separate(col = orcamento,
                            into = c("moeda_orcamento","orcamento"),  
                            sep = " ", remove = FALSE) %>% 
                   mutate(orcamento = as.double(orcamento)) 
       
      
      # receita
       imdb <-imdb %>% 
                   separate(col = receita,
                            into = c("moeda_receita","receita"),  
                            sep = " ", remove = FALSE) %>% 
                   mutate(receita = as.double(receita))        
       
      
      # receita_eua
       imdb <-imdb %>% 
                   separate(col = receita_eua,
                            into = c("moeda_receita_eua","receita_eua"),  
                            sep = " ", remove = FALSE) %>% 
                   mutate(receita_eua = as.double(receita_eua))
```

```{r include = FALSE, echo = FALSE, message=FALSE, warning=FALSE}
# Base de dados para trabalhar o lucro

imdb_lucrodolar <-   imdb %>% 
                               #select(titulo, 
                               #moeda_orcamento,orcamento, 
                               #moeda_receita, receita, 
                               #moeda_receita_eua,receita_eua) %>% 
                               drop_na(orcamento) %>% 
                               filter(moeda_orcamento == "$" & 
                                        moeda_receita == "$"&
                                        moeda_receita_eua == "$")

imdb_lucrodolar <- imdb_lucrodolar %>% 
                                           mutate(lucro_dolar = receita - orcamento) %>% 
                                           mutate(lucro_mi = lucro_dolar/1000000) %>%
                                           mutate(orcamento_mi = orcamento/1000000) %>% 
                                           mutate(receita_mi = receita/1000000) %>% 
                                           select(- c(moeda_orcamento,moeda_receita,
                                                      moeda_receita_eua, receita_eua)) 
       

```

```{r include = FALSE, echo = FALSE, message=FALSE, warning=FALSE}
# Configurando o tema dos gráficos    
  meu_tema <- theme(legend.position = "none",
                      axis.line.x = element_line(colour = "gray"),
                      axis.line.y = element_line(colour = "gray"),
                      
                      axis.title = element_text(face = "bold", size = 16),
                      axis.text.x = element_text(face = "plain", size=12),
                      axis.text.y = element_text(face = "plain", size=12),
                      
                      axis.ticks = element_line(colour = "gray", size = 0.2),
                      
                      panel.grid = element_blank(),
                      panel.background = element_blank())
```


```{r include = FALSE, echo = FALSE, message=FALSE, warning=FALSE}
total_filmes <- n_distinct(imdb$titulo)
filmes_usados <-n_distinct(imdb_lucrodolar$titulo)
```



## **Análises** 


O banco de dados possui o total de **`r total_filmes` filmes**. Para as análises referente ao lucro dos filmes, apenas **`r filmes_usados`** foram utilizados. Isso ocorreu após a exclusão de filmes com valores *NAs* para receita ou orçamento e também da exclusão de filmes que os mesmos campos não eram em dólar, o que dificultaria comparações.


## Filmes mais lucrativos de todos os tempos

Avatar e Avengers foram os filmes mais lucrativos de todos os tempos, lucrando mais de 2 bilhões de dólares cada um. Ultrapassando *Titanic*, que havia permanecido por anos como campeão de bilheterias.
![](../inst/avatar.png)

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.width = 7, fig.height = 6.5}
imdb_lucrodolar %>% 
      select(titulo_original, lucro_mi) %>% 
      arrange(desc(lucro_mi)) %>% 
      slice_max(n=20, order_by = lucro_mi, with_ties = TRUE) %>% 
      ggplot(aes(y = fct_reorder(titulo_original,lucro_mi,.desc = F),
                 x = lucro_mi,
                 label = round(lucro_mi, digits = 0))) +  
        geom_bar(stat = "identity", alpha = 1/2, color = "orange", fill= "lightblue") +       
        geom_label(position = position_stack (vjust = 0.5),alpha = 0.7, 
              colour = "orange", fontface = "bold", show_guide  = FALSE, size = 2.5)+
        scale_x_continuous(labels = scales::dollar)+
        xlab("Lucro (Milhões)")+
        ylab ("Títulos")+
        meu_tema
```

Ao olharmos para o número de filmes lançados desde 1920, percebemos que a **maior quantidade** se concentra em gêneros de **Drama**, **Comédia** e **Ação**.

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.width = 7, fig.height = 6.5}
# Numero de filmes em cada categoria - Número de títulos por gênero
       imdb_lucrodolar %>% 
          mutate(split_generos = str_split(genero, "\\, ")) %>%  
          unnest(split_generos) %>% 
          group_by(split_generos) %>%
          summarise(n_generos = n_distinct(titulo)) %>% 
          ggplot(aes(y = fct_reorder(split_generos, n_generos, .desc= F) , x = n_generos)) +
          geom_bar(stat = "identity", alpha = 1/2, color="orange", fill="lightblue") +
          xlab("Número de filmes")+
          ylab ("Gêneros")+
          meu_tema
        
```

Mas, embora estes gêneros possuam a maior quantidade de filmes lançados, não foram os gêneros mais lucrativos. O lucro médio foi maior para os gêneros de **Animação**, **Aventura**, **Ficção**, **Ação** e **Fantasia**.


O que nos leva a inferir que a melhor estratégia, em termos de retorno financeiro, seria investir na produção dos gêneros que têm apresentado maior lucro médio ao longo de todo o período registrado.

```{r include =  FALSE, echo = FALSE, message=FALSE, warning=FALSE}
#Salvar o banco de dados para usar o purr
imdb_lucrodolar_purr <- imdb_lucrodolar %>% 
                                  mutate(genero = str_split(genero, "\\, "),
                                         elenco = str_split(elenco, "\\, "),
                                         idioma = str_split(idioma, "\\, "),
                                         pais = str_split(pais,"\\, "),
                                         direcao = str_split(direcao,"\\, "),
                                         roteiro = str_split(roteiro,"\\, "))
        
```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.width = 7, fig.height = 6.5}
imdb_lucrodolar %>% 
            mutate(split_generos = str_split(genero, "\\, ")) %>%  
            unnest(split_generos) %>% 
            group_by(split_generos) %>% 
            summarise(media_lucro = mean(lucro_mi)) %>% 
            arrange(desc(media_lucro)) %>% 
            ggplot(aes(y = fct_reorder(split_generos, media_lucro, .desc= F) , x = media_lucro)) +
            geom_bar(stat = "identity", alpha = 1/2, color="orange", fill="lightblue")+
            scale_x_continuous(labels = scales::dollar)+
            xlab("Lucro Médio (Milhões)")+
            ylab ("Gêneros")+
            meu_tema
        
```

E será que existe diferença no lucro médio dos filmes ao longo dos meses? 


Os meses de Dezembro e Janeiro apresentaram maior lucro médio ao longo do tempo. Podemos, portanto, inferir que seriam meses interessantes para fazer o lançamento de um filme. 

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.width = 6, fig.height = 6}
imdb_lucrodolar_purr %>% 
          group_by(mes) %>% 
          drop_na(mes) %>% 
          summarise(media_lucro = mean(lucro_mi, na.rm = TRUE)) %>% 
          ggplot(aes(y = media_lucro, x= mes)) +
          geom_bar(stat = "identity", alpha = 1/2, color = "orange", fill="lightblue")+
          scale_y_continuous(labels = scales::dollar)+
          xlab("Mês")+
          ylab ("Lucro Médio (Milhões)")+
          meu_tema
        
```


Olhando agora apenas para os gêneros mais lucrativos, o período mensal mais propício para o lançamento se mantém?


Em Dezembro, todos os gêneros mantiveram os lucros médios altos. Além do mês de dezembro, para o gênero Ficção, os meses de Abril até Julho também foram meses com boa média de lucro; para o gênero Fantasia, novembro até janeiro; para Animação, os meses de agosto e novembro também obtiveram médias próximas a dezembro; para aventura, o lucro médio não variou ao longo dos meses. 


```{r echo = FALSE, message=FALSE, warning=FALSE, fig.width = 7, fig.height = 6.5}
imdb_lucrodolar_purr %>% 
          group_by(mes, genero) %>%
          unnest(genero) %>% 
          drop_na(mes) %>% 
          summarise(media = mean(lucro_mi)) %>% 
           filter(genero == "Animation"|
                     genero == "Adventure"|
                     genero == "Sci-Fi"|
                     genero == "Fantasy") %>% 
           ggplot(aes(y = media, x= mes, fill = genero, label = round(media,digits = 1))) +
           geom_bar(stat = "identity")+
            scale_fill_manual(values=c("#5B7694",
                                       "#048ABF",
                                       "#04B2D9",
                                       "#07354D"))+
           geom_label(position = position_stack (vjust = 0.5),alpha = 0.9, 
                      colour = "lightgray", fontface = "bold",size=2.5, show_guide  = FALSE)+
           coord_flip()+
           xlab("Mês")+
           ylab ("Lucro Médio (Milhões)") +
           meu_tema+
           theme(legend.position = "bottom")+
           labs(fill = NULL)
        
```


Olhos mais atentos notam que para o gênero animação houve um lucro médio muito acima das demais médias. Isso ocorreu devido


```{r echo = FALSE, message=FALSE, warning=FALSE, fig.width = 7, fig.height = 6.5}
imdb_lucrodolar_purr %>% 
          select(titulo_original, lucro_mi, genero) %>% 
          unnest(genero) %>%
          filter(genero == "Animation") %>% 
          arrange(desc(lucro_mi)) %>% 
          slice_max(n=20, order_by = lucro_mi, with_ties = TRUE) %>% 
          ggplot(aes(y = fct_reorder(titulo_original,lucro_mi,.desc = F), x = lucro_mi)) +  
          geom_bar(stat = "identity", alpha = 1/2, color= "orange", fill="lightblue") +     
          xlab("Lucro (Milhões)")+
          ylab ("Títulos")+
          scale_x_continuous(labels = scales::dollar)+
          annotate("text", x = 1250, y = 18, label = "2019", colour = "white", size = 5)+
          annotate("text", x = 2200, y = 18, label = "1994", colour = "white", size = 5)+
          theme(plot.margin = margin(t = 20,  # Top margin
                               r = 50,  # Right margin
                               b = 40,  # Bottom margin
                               l = 10),
        panel.border = element_blank())+ # Left margin)
          
          geom_segment( aes( x = 2500, y = 18, xend = 2400, yend = 18), 
                        arrow = arrow(length = unit(0.30,"cm"), type='closed'),
                        size=1, color='orange') + 
          geom_segment( aes( x = 1300, y = 16, xend = 1200, yend = 16), 
                        arrow = arrow(length = unit(0.30,"cm"), type='closed'),
                        size=1, color='orange') +         
          geom_segment( aes( x = 1200, y = 14, xend = 1100, yend = 14), 
                        arrow = arrow(length = unit(0.30,"cm"), type='closed'),
                        size=1, color='orange') +         
          geom_segment( aes( x = 1000, y = 6, xend = 900, yend = 6), 
                        arrow = arrow(length = unit(0.30,"cm"), type='closed'),
                        size=1, color='orange') +         
          geom_segment( aes( x = 900, y = 2, xend = 800, yend = 2), 
                        arrow = arrow(length = unit(0.30,"cm"), type='closed'),
                        size=1, color='orange') +         
          
          meu_tema
   

```


```{r echo = FALSE, message=FALSE, warning=FALSE}
```


```{r echo = FALSE, message=FALSE, warning=FALSE}
```


```{r echo = FALSE, message=FALSE, warning=FALSE}
```


```{r echo = FALSE, message=FALSE, warning=FALSE}
```


```{r echo = FALSE, message=FALSE, warning=FALSE}
```


```{r echo = FALSE, message=FALSE, warning=FALSE}
```


```{r echo = FALSE, message=FALSE, warning=FALSE}
```


```{r echo = FALSE, message=FALSE, warning=FALSE}
